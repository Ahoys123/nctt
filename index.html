<!DOCTYPE html>
<!--
Copyright 2018 The Go Authors. All rights reserved.
Use of this source code is governed by a BSD-style
license that can be found in the LICENSE file.
-->
<html>
  <head>
    <meta charset="utf-8" />
    <title>Go wasm</title>
    <script src="wasm_exec.js"></script>
    <link rel="stylesheet" href="termstyle.css">
  </head>

  <body>
    <pre id="terminal"></pre>
    <script>
        const term = document.getElementById("terminal")
        const width = 79
        const height = 20

        var content = new Array(height)
        var clickaudio = new Audio('assets/click.wav');
        var dingaudio = new Audio('assets/ding.wav');

        for (let i = 0; i < height; i++) {
          content[i] = new Array(width)
          for (let j = 0; j < width; j++) {
            content[i][j] = {char : " ", style : "normal", front : "", back : ""}
          }
        }

        function getContent(x, y) {
          let thing = content[y][x]
          return [thing.char, thing.style]
        }

        function setContent(x, y, c, s) {
          let stylefront = ""
          switch (s) {
            case "option":
              stylefront = "<span class=\"option\">"
              break;
            case "popup":
              stylefront = "<span class=\"popup\">"
              break;
            case "popupBox":
              stylefront = "<span class=\"popupBox\">"
              break;
            case "t1ln":
              stylefront = "<span class=\"t1ln\">"
              break;
            case "t1en":
              stylefront = "<span class=\"t1en\">"
              break;
            case "t1ne":
              stylefront = "<span class=\"t1ne\">"
              break;
            case "t2ne":
              stylefront = "<span class=\"t2ne\">"
              break;
            default:
              break;
          }
          content[y][x] = {char : c, style : s, front : stylefront, back : (stylefront == "" ? "" : "</span>")}
        }

        function show() {
          console.log("showing!")
          final = ""
          content.forEach(row => {
            row.forEach(c => { final += c.front + c.char + c.back })
            final += "\n"
          })//final += element.join("") + "\n"})
          term.innerHTML = final
        }

        function click() {
          clickaudio.pause()
          clickaudio.currentTime = 0;
          clickaudio.play();
        }

        function ding() {
          dingaudio.pause()
          dingaudio.currentTime = 0;
          dingaudio.play();
        }

        show()

        let fontwidth = term.clientWidth / width
        let fontheight = term.clientHeight / height

        document.addEventListener("keydown", e => {
          switch (e.key) {
            case "ArrowUp":
              onSpecialKey("up")
              break;
            case "ArrowDown":
              onSpecialKey("down")
              break;
            case "ArrowLeft":
              onSpecialKey("left")
              break;
            case "ArrowRight":
              onSpecialKey("right")
              break;
            case "Backspace":
              onSpecialKey("backspace")
              break;
            case "Enter":
              onSpecialKey("enter")
              break;
            case "Escape":
              onSpecialKey("reset")
              break;
            default:
              if (e.key.length == 1) {
                onKeyPressed(e.key)
              }
              break;
          }
        })

        term.addEventListener("mousemove", e => {
          onMouseMove(parseInt(e.offsetX / fontwidth), parseInt(e.offsetY / fontheight))
        })
        

        const go = new Go();
        WebAssembly.instantiateStreaming(fetch("lib.wasm"), go.importObject).then((result) => {
            go.run(result.instance);
        });
    </script>
  </body>
</html>

<!--
switch (style) {
  case "option":
    stylefront = "<span class=\"option\">"
    break;
  case "popup":
    stylefront = "<span class=\"popup\">"
    break;
  case "popupBox":
    stylefront = "<span class=\"popupBox\">"
    break;
  case "t1ln":
    stylefront = "<span class=\"t1ln\">"
    break;
  case "t1en":
    stylefront = "<span class=\"t1en\">"
    break;
  case "t1ne":
    stylefront = "<span class=\"t1ne\">"
    break;
  case "t2ne":
    stylefront = "<span class=\"t2ne\">"
    break;
  default:
    break;
}
-->